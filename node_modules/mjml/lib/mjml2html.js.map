{"version":3,"sources":["../src/mjml2html.js"],"names":[],"mappings":"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","file":"mjml2html.js","sourcesContent":["import cheerio from \"cheerio\";\nimport defaultStyle from \"./defaultStyle\"\nimport documentParser from \"./documentParser\";\nimport MJMLElementsCollection from \"./MJMLElementsCollection\";\nimport { EmptyMJMLError } from './Error';\n\nimport React from \"react\";\nimport ReactDOMServer from \"react-dom/server\";\nimport _ from \"lodash\";\n\nconst debug = require(\"debug\")(\"mjml-engine/mjml2html\");\n\nconst internals = {\n  mjml2html(content, options = {}) {\n    let parsedContent = content\n\n    if (typeof content == \"string\") {\n      debug(\"Start parsing content\")\n      parsedContent = documentParser(content)\n      debug(\"Content parsed.\")\n    }\n\n    debug(\"Start rendering\")\n    const render = internals.render({mjml: parsedContent, options})\n    debug(\"Done rendering\")\n\n    return render\n  },\n\n  render({ mjml, options }) {\n    const elem  = mjml\n    let content = \"\"\n\n    if (elem) {\n      const propsElement = {\n        key: 0,\n        elem: elem\n      }\n\n      debug(\"Create root React element\")\n      const rootElemComponent = React.createElement(MJMLElementsCollection[elem.tagName.substr(3)], propsElement)\n\n      debug(\"Render to static markup\")\n      content = ReactDOMServer.renderToStaticMarkup(rootElemComponent)\n    } else {\n      throw (new EmptyMJMLError('.render: No MJML to render in options ' + options.toString()))\n    }\n\n    debug(\"React rendering done. Continue with special overrides.\")\n\n    const $ = cheerio.load(internals.container(options.title), {decodeEntities: false})\n\n    $(\"#YIELD_MJML\").html(content)\n    $(\".mj-raw\").each(function() {\n      $(this).replaceWith($(this).html())\n    })\n\n    internals.insertColumnMediaQuery($)\n    internals.fixLegacyAttrs($)\n    internals.fixOutlookLayout($)\n\n    return $.html()\n  },\n\n  insertColumnMediaQuery($) {\n    const mediaQuery = $(`<style type=\"text/css\">\n    @media only screen and (min-width:480px) {\n    </style>`)\n\n    _.each({\"mj-column-per\": \"%\", \"mj-column-px\": \"px\"}, (unit, className) => {\n      const columnWidths = []\n\n      $(`[class*='${className}']`).each(function() {\n        columnWidths.push($(this).data('column-width'))\n        $(this).removeAttr('data-column-width')\n      })\n\n      _.uniq(columnWidths).forEach((width) => {\n        const mediaQueryClass = `${className}-${width}`\n\n        mediaQuery.append(`.${mediaQueryClass}, * [aria-labelledby=\"${mediaQueryClass}\"] { width:${width}${unit}!important; }\\n`)\n      })\n    })\n\n    mediaQuery.append(`}`)\n\n    $('head').append(mediaQuery)\n  },\n\n  fixOutlookLayout($) {\n    const bodyWidth = $('.mj-body').data('width')\n    $('.mj-body').removeAttr('data-width')\n\n    $(\".outlook-background-fix-open\").each(function() {\n      const url = $(this).data('url')\n      const width = $(this).data('width')\n\n      $(this).removeClass('outlook-background-fix-open')\n             .removeAttr('data-url')\n             .removeAttr('data-width')\n\n      if (!url) {\n        return;\n      }\n\n      $(this).before(`\n          <!--[if gte mso 9]>\n          <v:rect xmlns:v=\"urn:schemas-microsoft-com:vml\" fill=\"true\" stroke=\"false\" style=\"width:${width}px;\">\n            <v:fill origin=\"0.5, 0\" position=\"0.5,0\" type=\"tile\" src=\"${url}\" />\n            <v:textbox style=\"mso-fit-shape-to-text:true\" inset=\"0,0,0,0\">\n          <![endif]-->`)\n\n      $(this).after(`\n        <!--[if gte mso 9]>\n          </v:textbox>\n        </v:rect>\n        <![endif]-->\n      `)\n    })\n\n    $(\".mj-body-outlook-open\").each(function() {\n      $(this).replaceWith(`<!--[if mso]>\n  \t\t<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" width=\"${bodyWidth}\" align=\"center\" style=\"width:${bodyWidth}px;\"><tr><td>\n  \t\t<![endif]-->`)\n    })\n\n    $(\".mj-body-outlook-line\").each(function() {\n      $(this).replaceWith(`<!--[if mso]>\n      </td></tr></table>\n  \t\t<![endif]-->\n  \t\t<!--[if mso]>\n  \t\t<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" width=\"${bodyWidth}\" align=\"center\" style=\"width:${bodyWidth}px;\"><tr><td>\n  \t\t<![endif]-->`)\n    })\n\n    $(\".mj-body-outlook-close\").each(function() {\n      $(this).replaceWith(`<!--[if mso]>\n  \t\t</td></tr></table>\n  \t\t<![endif]-->`)\n    })\n\n    $(\".mj-section-outlook-open\").each(function() {\n      $(this).replaceWith(`<!--[if mso]>\n      <table border=\"0\" cellpadding=\"0\" cellspacing=\"0\"><tr><td style=\"width:${parseInt($(this).data('width'))}px;\">\n      <![endif]-->`)\n    })\n\n    $(\".mj-section-outlook-line\").each(function() {\n      $(this).replaceWith(`<!--[if mso]>\n      </td><td style=\"width:${parseInt($(this).data('width'))}px;\">\n      <![endif]-->`)\n    })\n\n    $(\".mj-section-outlook-close\").each(function() {\n      $(this).replaceWith(`<!--[if mso]>\n      </td></tr></table>\n      <![endif]-->`)\n    })\n\n    $(\".mj-social-outlook-open\").each(function() {\n      $(this).replaceWith(`<!--[if mso]>\n      <table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" align=\"center\"><tr><td>\n      <![endif]-->`)\n    })\n\n    $(\".mj-social-outlook-line\").each(function() {\n      $(this).replaceWith(`<!--[if mso]>\n        </td><td>\n        <![endif]-->`)\n    })\n\n    $(\".mj-social-outlook-close\").each(function() {\n      $(this).replaceWith(`<!--[if mso]>\n      \t</td></tr></table>\n      \t<![endif]-->`)\n    })\n\n    $(\".outlook-divider-fix\").each(function() {\n      const $insertNode = $('<table></table>').css($(this).css())\n\n      $(this).removeClass(\"outlook-divider-fix\")\n             .after(`<!--[if mso]>${$insertNode}<![endif]-->`)\n    })\n  },\n\n  fixLegacyAttrs($) {\n    const legacyAttrs = [\"align\", \"valign\", \"bgcolor\", \"border\", \"background\"]\n\n    $(\"#YIELD_MJML\").css({background: $(\".mj-body\").data('background-color')})\n    $(\".mj-body\").removeAttr('data-background-color')\n\n    // https://github.com/facebook/react/issues/140 ...\n    // server side workaround to allow custom tags.\n    legacyAttrs.forEach((attr) => {\n      const dataAttr = `data-legacy-${attr}`\n\n      $(`[${dataAttr}]`).each(function() {\n        $(this).attr(attr, $(this).attr(dataAttr))\n        $(this).removeAttr(dataAttr)\n      });\n    })\n  },\n\n  container(title = '') {\n    return `<!doctype html>\n<html xmlns=\"http://www.w3.org/1999/xhtml\">\n<head>\n  <meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\"/>\n  <title>${title}</title>\n  <style type=\"text/css\">\n    ${defaultStyle}\n  </style>\n  <!--[if !mso]><!-->\n  <style type=\"text/css\">\n    @import url(https://fonts.googleapis.com/css?family=Ubuntu:400,500,700,300);\n  </style>\n  <style type=\"text/css\">\n    @media only screen and (max-width:480px) {\n      @-ms-viewport { width:320px; }\n      @viewport { width:320px; }\n    }\n  </style>\n  <link href=\"https://fonts.googleapis.com/css?family=Ubuntu:400,500,700,300\" rel=\"stylesheet\" type=\"text/css\">\n  <!--<![endif]-->\n</head>\n<body id=\"YIELD_MJML\">\n</body>\n</html>\n`;\n  }\n}\n\nexport default internals.mjml2html;\n"]}