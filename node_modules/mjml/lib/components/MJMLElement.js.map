{"version":3,"sources":["../../src/components/MJMLElement.js"],"names":[],"mappings":"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","file":"MJMLElement.js","sourcesContent":["import Immutable from 'immutable'\nimport MJMLElementsCollection from '../MJMLElementsCollection'\nimport React, { Component } from 'react'\nimport _ from 'lodash'\nimport { UnknownMJMLElement } from '../Error'\n\nconst getElementWidth = (element, siblings) => {\n  const { elem } = element.props\n  let { width } = element.props\n\n  if (!width && elem && elem.attributes && elem.attributes.width) {\n    width = elem.attributes.width\n  }\n\n  if (width == undefined) {\n    return 600 / siblings\n  }\n\n  const widthUnit = /[0-9]+([^ ,\\)`]*)/.exec(width.toString())[1]\n\n  switch(widthUnit) {\n  case '%':\n    return parseInt(width) * 6 // * 600 / 100\n\n  case 'px':\n  default:\n    return parseInt(width)\n  }\n}\n\nfunction createComponent(ComposedComponent, defaultAttributes) {\n\n  class MJMLElement extends Component {\n\n    constructor(props) {\n      super(props)\n\n      this.state = Immutable.fromJS({\n        elem: _.merge({\n          children: [],\n          attributes: {}\n        }, defaultAttributes)\n      })\n\n      this.state = this.state.mergeDeep(props)\n    }\n\n    mjAttribute(name) {\n      if (this.props[name] != undefined) {\n        return this.props[name]\n      }\n\n      return this.state.getIn(['elem', 'attributes']).get(name)\n    }\n\n    mjContent() {\n      return _.trim(this.state.getIn(['elem', 'content'])) || React.renderToStaticMarkup(this.props.children)\n    }\n\n    mjElementName() {\n      return this.state.getIn(['elem', 'tagName']).substr(3)\n    }\n\n    childDefaultProps(id) {\n      return {\n        id,\n        key: id,\n        color: this.mjAttribute('color'),\n        parentWidth: this.mjAttribute('width'),\n        verticalAlign: this.mjAttribute('vertical-align')\n      }\n    }\n\n    renderWrappedOutlookChildren() {\n      let elements          = this.renderChildren()\n      const wrappedElements = []\n      const prefix          = `mj-${this.mjElementName()}-outlook`\n\n      if (elements && elements.get) {\n        // had to break immutable here :(\n        elements = elements.toArray()\n      }\n\n      if (elements.length == 0) {\n        return []\n      }\n\n      elements.forEach((element, n) => {\n        wrappedElements.push(element)\n        if ( n < elements.length - 1 ) {\n          const width = getElementWidth(elements[n+1], elements.length)\n\n          wrappedElements.push(<div className={`${prefix}-line`} data-width={width}/>)\n        }\n      })\n\n      const outlookOpenTag  = <div className={`${prefix}-open`} data-width={getElementWidth(elements[0], elements.length)} />\n      const outlookCloseTag = <div className={`${prefix}-close`} />\n\n      return [outlookOpenTag].concat(wrappedElements, [outlookCloseTag])\n    }\n\n    upgradeReactChildren(children) {\n      const sibling = React.Children.count(children)\n\n      return children.map((child, i) => {\n        return React.cloneElement(child, _.merge(this.childDefaultProps(i), { sibling }))\n      })\n    }\n\n    renderChildren() {\n      const children = this.state.getIn(['elem', 'children'])\n\n      if (!children ||Â children.count() === 0 && React.Children.count(this.props.children) >= 1) {\n        return this.upgradeReactChildren(React.Children.toArray(this.props.children));\n      }\n\n      let i = 0\n\n      return children.map((elem) => {\n        if (elem.get('tagName') && elem.get('tagName').indexOf('mj-') != -1) {\n          i++\n\n          const Element = MJMLElementsCollection[elem.get('tagName').substr(3)]\n\n          if (!Element) {\n            throw new UnknownMJMLElement(`Could not find element for : ${elem.get('tagName')}`)\n          }\n\n          const props = _.merge(this.childDefaultProps(i), {\n            elem: elem.toJS(),\n            sibling: children.size\n          })\n\n          return React.createElement(Element, props)\n        }\n      })\n    }\n\n    render() {\n      return (\n        <ComposedComponent\n          {...this.props}\n          mjAttribute={::this.mjAttribute}\n          mjContent={::this.mjContent}\n          mjElementName={::this.mjElementName}\n          renderChildren={::this.renderChildren}\n          renderWrappedOutlookChildren={::this.renderWrappedOutlookChildren} />\n      )\n    }\n\n  }\n\n  return MJMLElement\n\n}\n\nexport default (defaultAttributes) => {\n  if (typeof defaultAttributes == 'function') {\n    return createComponent(defaultAttributes)\n  }\n\n  return ComposedComponent => createComponent(ComposedComponent, defaultAttributes)\n}\n"]}