{"version":3,"sources":["../../../src/components/decorators/MJMLElement.js"],"names":[],"mappings":"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","file":"MJMLElement.js","sourcesContent":["import Immutable from 'immutable'\nimport MJMLElementsCollection from '../../MJMLElementsCollection'\nimport React, { Component } from 'react'\nimport _ from 'lodash'\nimport { widthParser, paddingParser } from \"../../helpers/mjAttribute\"\nimport { UnknownMJMLElement } from '../../Error'\n\nconst getElementWidth = ({element, siblings, parentWidth}) => {\n  const { elem } = element.props\n  let { width } = element.props\n\n  if (!width && elem && elem.attributes && elem.attributes.width) {\n    width = elem.attributes.width\n  }\n\n  if (width == undefined) {\n    return parentWidth / siblings\n  }\n\n  const { width: parsedWidth, unit } = widthParser(width)\n\n  switch(unit) {\n    case '%':\n      return parsedWidth * parentWidth / 100\n\n    case 'px':\n    default:\n      return parsedWidth\n  }\n}\n\nfunction createComponent(ComposedComponent, defaultAttributes) {\n\n  class MJMLElement extends Component {\n\n    constructor(props) {\n      super(props)\n\n      this.state = Immutable.fromJS({\n        elem: _.merge({\n          children: [],\n          attributes: {},\n          inheritedAttributes: []\n        }, defaultAttributes)\n      })\n\n      this.state = this.state.mergeDeep(props)\n    }\n\n    mjAttribute(name) {\n      if (this.props[name] != undefined) {\n        return this.props[name]\n      }\n\n      return this.state.getIn(['elem', 'attributes']).get(name)\n    }\n\n    mjContent() {\n      return _.trim(this.state.getIn(['elem', 'content'])) || (this.props.children && React.renderToStaticMarkup(this.props.children))\n    }\n\n    mjElementName() {\n      return this.state.getIn(['elem', 'tagName']).substr(3)\n    }\n\n    inheritedAttributes() {\n      return _.reduce(this.state.getIn(['elem', 'inheritedAttributes']).toJS(), (result, value) => {\n        result[value] = this.mjAttribute(value)\n        return result\n      }, {})\n    }\n\n    isInheritedAttributes(name) {\n      return _.indexOf(this.state.getIn(['elem', 'inheritedAttributes']).toJS(), name) != -1\n    }\n\n    siblingsCount() {\n      const children = this.state.getIn(['elem', 'children'])\n\n      return this.hasReactChildren() ?  React.Children.count(children) : this.state.getIn(['elem', 'children']).size\n    }\n\n    getWidth() {\n      return this.mjAttribute('rawPxWidth') || this.mjAttribute('width')\n    }\n\n    childDefaultProps(id) {\n      return {\n        id,\n        key: id,\n        color: this.mjAttribute('color'),\n        parentWidth: this.getWidth(),\n        verticalAlign: this.mjAttribute('vertical-align'),\n        sibling: this.siblingsCount()\n      }\n    }\n\n    renderWrappedOutlookChildren() {\n      let elements          = this.renderChildren()\n\n      if (elements && elements.get) {\n        // had to break immutable here :(\n        elements = elements.toArray()\n      }\n\n      const prefix          = `mj-${this.mjElementName()}-outlook`\n      const parentWidth     = this.getWidth()\n      const siblings        = elements.length\n      const elementsWidth   = elements.map((element) => {\n        if (this.isInheritedAttributes('width')) {\n          return parentWidth\n        }\n\n        return getElementWidth({element, siblings, parentWidth})\n      })\n\n      if (siblings == 0) {\n        return []\n      }\n\n      const wrappedElements = elements.reduce((result, element, n) => {\n        result.push(React.cloneElement(element, _.merge({rawPxWidth: elementsWidth[n]}, this.inheritedAttributes())))\n\n        if ( n < elements.length - 1 ) {\n          result.push(<div key={`outlook-${n}`}className={`${prefix}-line`} data-width={elementsWidth[n+1]}/>)\n        }\n\n        return result\n      }, [<div key=\"outlook-open\" className={`${prefix}-open`} data-width={elementsWidth[0]} />])\n\n      wrappedElements.push(<div key=\"outlook-close\" className={`${prefix}-close`} />)\n\n      return wrappedElements\n    }\n\n    upgradeReactChildren(children) {\n      return children.map((child, i) => {\n        return React.cloneElement(child, this.childDefaultProps(i))\n      })\n    }\n\n    hasReactChildren() {\n      const children = this.state.getIn(['elem', 'children'])\n\n      return !children || children.count() === 0 && React.Children.count(this.props.children) >= 1\n    }\n\n    renderChildren() {\n      if (this.hasReactChildren()) {\n        return this.upgradeReactChildren(React.Children.toArray(this.props.children));\n      }\n\n      const children = this.state.getIn(['elem', 'children'])\n      let i = 0\n\n      return children.map((elem) => {\n        if (elem.get('tagName') && elem.get('tagName').indexOf('mj-') != -1) {\n          i++\n\n          const Element = MJMLElementsCollection[elem.get('tagName').substr(3)]\n\n          if (!Element) {\n            throw new UnknownMJMLElement(`Could not find element for : ${elem.get('tagName')}`)\n          }\n\n          const props = _.merge(this.childDefaultProps(i), {\n            elem: elem.toJS()\n          })\n\n          return React.createElement(Element, props)\n        }\n      })\n    }\n\n    render() {\n      return (\n        <ComposedComponent\n          {...this.props}\n          mjAttribute={::this.mjAttribute}\n          mjContent={::this.mjContent}\n          mjElementName={::this.mjElementName}\n          renderChildren={::this.renderChildren}\n          getPadding={paddingParser.bind(this)}\n          renderWrappedOutlookChildren={::this.renderWrappedOutlookChildren} />\n      )\n    }\n\n  }\n\n  return MJMLElement\n\n}\n\nexport default (defaultAttributes) => {\n  if (typeof defaultAttributes == 'function') {\n    return createComponent(defaultAttributes)\n  }\n\n  return ComposedComponent => createComponent(ComposedComponent, defaultAttributes)\n}\n"]}